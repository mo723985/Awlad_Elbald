<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d6efd">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="My App">

    <title>ูุธุงู ุฅุฏุงุฑุฉ ูุญู ุงููุงุฏ ุงูุจูุฏ</title>
    <!-- ูููุงุช ุงูุชูุณูู -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <!-- ============================================ -->
    <!-- 1. ุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู (Login) -->
    <!-- ============================================ -->
    <div id="view-login" class="login-overlay">
        <div class="login-box">
            <h2>๐ ุชุณุฌูู ุงูุฏุฎูู</h2>
            <p>ุฃุฏุฎู ุฑูุฒ ุงููุธุงู ูููุชุงุจุนุฉ</p>
            <form id="form-login">
                <input type="password" id="login-password" placeholder="ูููุฉ ุงููุฑูุฑ" required>
                <button type="submit" class="btn-primary" style="width: 100%;">ุฏุฎูู</button>
                <p id="login-error" class="error-text"></p>
            </form>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- 2. ุงูุญุงููุฉ ุงูุฑุฆูุณูุฉ ููุชุทุจูู -->
    <!-- ============================================ -->
    <div id="app-container" style="display: none;">
        
        <!-- ุงููุงุฆูุฉ ุงูุนูููุฉ (ุชุฎุชูู ุนูุฏ ุงูุทุจุงุนุฉ) -->
        <nav class="main-nav no-print">
            <div class="nav-logo"><i class="fa fa-wrench"></i> ุงููุงุฏ ุงูุจูุฏ</div>
            <div class="nav-links">
                <button class="nav-btn" data-target="view-dashboard">ุงูุฑุฆูุณูุฉ</button>
                <button class="nav-btn" data-target="view-inventory">ุงููุฎุฒู</button>
                <button class="nav-btn" data-target="view-partners">ุงูุนููุงุก ูุงูููุฑุฏูู</button>
                <button class="nav-btn" data-target="view-invoices">ุงูููุงุชูุฑ</button>
                <button id="btn-logout" class="btn-danger">ุฎุฑูุฌ</button>
            </div>
        </nav>

        <main id="main-content">
            
            <!-- ุฃ) ููุญุฉ ุงูุชุญูู (Dashboard) -->
            <section id="view-dashboard" class="app-view">
                <div class="section-header">
                    <h2>๐ ููุญุฉ ุงููุนูููุงุช</h2>
                </div>
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <h3><i class="fa fa-users"></i> ุนุฏุฏ ุงูุนููุงุก ูุงูููุฑุฏูู</h3>
                        <p id="stat-customers-count">0</p>
                    </div>
                    <div class="stat-card">
                        <h3><i class="fa fa-box"></i> ุฃุตูุงู ุจุงููุฎุฒู</h3>
                        <p id="stat-stock-count">0</p>
                    </div>
                </div>
                <!-- ุงูุฒุฑ ููุง ูุญูู ID ูุญุฏุฏ ูุฑุจุทู ุจููู app.js -->
                <div class="quick-actions no-print" style="margin-top: 30px; text-align: center;">
                    <button id="btn-quick-invoice" class="btn-primary-lg">๐งพ ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ</button>
                </div>
            </section>

            <!-- ุจ) ุงููุฎุฒู (Inventory) -->
            <section id="view-inventory" class="app-view" style="display: none;">
                <div class="section-header">
                    <h2>๐ฆ ุฅุฏุงุฑุฉ ุงููุฎุฒู</h2>
                    <button id="btn-open-add-product" class="btn-primary no-print">+ ุตูู ุฌุฏูุฏ</button>
                </div>
                <div class="filter-bar no-print">
                    <input type="text" id="inventory-search-input" placeholder="ุจุญุซ ุจุงุณู ุงูููุชุฌ...">
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ุงุณู ุงูุตูู</th>
                                <th>ุณุนุฑ ุงูุดุฑุงุก</th>
                                <th>ุณุนุฑ ุงูุจูุน</th>
                                <th>ุงููููุฉ ุงูุญุงููุฉ</th>
                                <th>ุญุฏ ุงูุฃูุงู</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-list-body"></tbody>
                    </table>
                </div>
            </section>

            <!-- ุฌ) ุงูุนููุงุก ูุงูููุฑุฏูู (Partners) -->
            <section id="view-partners" class="app-view" style="display: none;">
                <div class="section-header">
                    <h2>๐ฅ ุงูุนููุงุก ูุงูููุฑุฏูู</h2>
                    <button id="btn-open-add-partner" class="btn-primary no-print">+ ุงุถุงูุฉ ุฌุฏูุฏ</button>
                </div>
                <div class="filter-bar no-print">
                    <select id="partner-type-filter">
                        <option value="all">ุนุฑุถ ุงููู</option>
                        <option value="customer">ุงูุนููุงุก ููุท</option>
                        <option value="supplier">ุงูููุฑุฏูู ููุท</option>
                    </select>
                    <input type="text" id="partner-search-input" placeholder="ุจุญุซ ุจุงูุงุณู...">
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ุงูุงุณู</th>
                                <th>ุงูููุน</th>
                                <th class="no-print">ุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="partners-list-body"></tbody>
                    </table>
                </div>
            </section>

            <!-- ุฏ) ูุดู ุงูุญุณุงุจ (Ledger) -->
            <section id="view-partner-details" class="app-view" style="display: none;">
                <div class="section-header">
                    <button class="btn-back no-print" data-target="view-partners">โ ุนูุฏุฉ</button>
                    <h2 id="ledger-partner-name">ุงุณู ุงูุดุฑูู</h2>
                    <button onclick="window.print()" class="btn-success no-print"><i class="fa fa-print"></i> ุทุจุงุนุฉ ุงููุดู</button>
                </div>
                <div class="balance-card">
                    <h3 id="ledger-current-balance">ุงูุฑุตูุฏ: 0.00</h3>
                </div>
                <div class="no-print" style="margin-bottom: 20px;">
                    <button id="btn-ledger-add-payment" class="btn-primary">๐ฐ ุชุณุฌูู ุฏูุนุฉ ููุฏูุฉ</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ุงูุชุงุฑูุฎ</th>
                                <th>ููุน ุงูุญุฑูุฉ</th>
                                <th>ุงููููุฉ</th>
                                <th>ููุงุญุธุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="ledger-transactions-body"></tbody>
                    </table>
                </div>
            </section>

            <!-- ูู) ุฅูุดุงุก ูุงุชูุฑุฉ (Create Invoice) -->
            <section id="view-create-invoice" class="app-view" style="display: none;">
                
                <!-- /// 1. ููุทูุฉ ุงูุทุจุงุนุฉ ููุท (ุชุธูุฑ ูู ุงููุฑูุฉ) /// -->
                <div class="print-only invoice-header-print">
                    <div class="shop-info">
                        <h1>ูุคุณุณุฉ ุงููุงุฏ ุงูุจูุฏ</h1>
                        <p>๐ ุงูุนููุงู: ุณุนุฏ ุดุงููุด</p>
                        <p>๐ ุชููููู : 01203089081</p>
                    </div>
                    <div class="invoice-details-print">
                        <h2 id="print-invoice-title">ูุงุชูุฑุฉ</h2>
                        <p>ุงูุชุงุฑูุฎ: <span id="print-date"></span></p>
                        <p>ุงูุณูุฏ/ุงูุณุงุฏุฉ: <span id="print-partner"></span></p>
                        <p>ุฑูู ุงููุงุชูุฑุฉ: <span id="print-invoice-id"></span></p>
                    </div>
                </div>
                <!-- /// ููุงูุฉ ููุทูุฉ ุงูุทุจุงุนุฉ /// -->

                <div class="section-header no-print">
                    <button class="btn-back" data-target="view-dashboard">โ ุฅูุบุงุก</button>
                    <h2>๐ ูุงุชูุฑุฉ ุฌุฏูุฏุฉ</h2>
                </div>

                <form id="form-create-invoice">
                    <!-- ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ -->
                    <div class="invoice-grid no-print">
                        <div class="form-group">
                            <label>ููุน ุงููุงุชูุฑุฉ</label>
                            <select id="invoice-type">
                                <option value="sale">ุจูุน (ููุนููู)</option>
                                <option value="purchase">ุดุฑุงุก (ูู ููุฑุฏ)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ุงุฎุชุฑ ุงูุดุฑูู</label>
                            <select id="invoice-partner-select" required></select>
                        </div>
                        <div class="form-group">
                            <label>ุชุงุฑูุฎ ุงููุงุชูุฑุฉ</label>
                            <input type="date" id="invoice-date" required>
                        </div>
                    </div>
                    
                    <hr class="no-print" style="margin: 20px 0; border-top: 1px dashed #ccc;">

                    <!-- ุงุฎุชูุงุฑ ุงูุฃุตูุงู (ูุน ุญูู ุงูุณุนุฑ ุงูุฌุฏูุฏ) -->
                    <div class="item-selector-box no-print">
                        <div class="form-group" style="flex: 2; position: relative;">
                            <label>ุจุญุซ ุนู ุตูู</label>
                            <input type="text" id="invoice-product-search" placeholder="ุงูุชุจ ุงุณู ุงูููุชุฌ..." autocomplete="off">
                            <div id="product-search-results" class="search-dropdown" style="display: none;"></div>
                            <input type="hidden" id="invoice-product-select">
                        </div>
                        <div class="form-group" style="width: 80px;">
                            <label>ุงููููุฉ</label>
                            <input type="number" id="invoice-qty" value="1" min="1">
                        </div>
                        <div class="form-group" style="width: 120px;">
                            <label id="label-price-display">ุณุนุฑ ุงููุญุฏุฉ</label>
                            <input type="number" id="invoice-price" placeholder="0.00">
                        </div>
                        
                        <!-- ูุฐุง ุงูุญูู ูุธูุฑ ููุท ุนูุฏ ุงูุดุฑุงุก ูุชุญุฏูุซ ุณุนุฑ ุงูุจูุน -->
                        <div class="form-group" id="group-new-sell-price" style="display: none; width: 140px;">
                            <label style="color: var(--success-color); font-weight: bold;">ุณุนุฑ ุงูุจูุน ุงูุฌุฏูุฏ</label>
                            <input type="number" id="invoice-new-sell-price" placeholder="ุชุญุฏูุซ ุงูุณุนุฑ">
                        </div>

                        <button type="button" id="btn-add-item-to-list" class="btn-success">ุฅุถุงูุฉ</button>
                    </div>

                    <!-- ุฌุฏูู ุงูุฃุตูุงู -->
                    <div class="table-container">
                        <table class="invoice-table">
                            <thead>
                                <tr>
                                    <th>ุงูุตูู</th>
                                    <th>ุงููููุฉ</th>
                                    <th>ุณุนุฑ ุงููุญุฏุฉ</th>
                                    <th>ุงูุฅุฌูุงูู</th>
                                    <th class="no-print">ุญุฐู</th>
                                </tr>
                            </thead>
                            <tbody id="invoice-items-body"></tbody>
                        </table>
                    </div>

                    <!-- ููุฎุต ุงููุงุชูุฑุฉ (ููุดุงุดุฉ ูุงูุทุจุงุนุฉ) -->
                    <div class="invoice-summary">
                        <!-- ุงูุฅุฌูุงูู -->
                        <div class="summary-row">
                            <span>ุงูุฅุฌูุงูู (Total):</span>
                            <span id="invoice-total-amount" class="no-print">0.00</span>
                            <span id="print-total" class="print-only" style="display:none;">0.00</span>
                        </div>

                        <!-- ุงููุฏููุน -->
                        <div class="summary-row">
                            <span>ุงููุฏููุน (Paid):</span>
                            <!-- ุฅุฏุฎุงู ููุดุงุดุฉ -->
                            <input type="number" id="invoice-paid-amount" value="0" class="no-print">
                            <!-- ูุต ููุทุจุงุนุฉ -->
                            <span id="print-paid" class="print-only" style="display:none;">0.00</span>
                        </div>

                        <!-- ุงููุชุจูู (ูุธูุฑ ูู ุงูุทุจุงุนุฉ ููุท) -->
                        <div class="summary-row print-only" style="display:none; margin-top: 10px; border-top: 1px solid #000; padding-top: 5px;">
                            <span>ุงููุชุจูู (Remaining):</span>
                            <span id="print-remaining" style="font-weight: bold;">0.00</span>
                        </div>

                        <button type="submit" class="btn-primary-lg no-print">๐พ ุญูุธ ูุทุจุงุนุฉ</button>
                    </div>
                </form>
            </section>

            <!-- ู) ุณุฌู ุงูููุงุชูุฑ -->
            <section id="view-invoices" class="app-view" style="display: none;">
                <div class="section-header">
                    <h2>๐๏ธ ุณุฌู ุงูููุงุชูุฑ</h2>
                </div>
                <div class="table-container">
                    <div class="filter-bar no-print">

    <!-- ุจุญุซ ุจุฑูู ุงููุงุชูุฑุฉ -->
    <input 
        type="text" 
        id="invoice-search-input"
        placeholder="๐ ุจุญุซ ุจุฑูู ุงููุงุชูุฑุฉ..."
    >

</div>

                    <table>
                        <thead>
                            <tr>
                                <th>ุฑูู ุงููุงุชูุฑุฉ</th>
                                <th>ุงูุชุงุฑูุฎ</th>
                                <th>ุงูุดุฑูู</th>
                                <th>ุงูููุน</th>
                                <th>ุงููููุฉ</th>
                                <th>ุงููุฏููุน</th>
                                <th class="no-print">ุฅุฌุฑุงุก</th>
                            </tr>
                        </thead>
                        <tbody id="invoices-list-body"></tbody>
                    </table>
                </div>
            </section>

        </main>
    </div>

    <!-- ============================================ -->
    <!-- 3. ุงูููุฏุงูุงุช (Popups) -->
    <!-- ============================================ -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;">
        
        <!-- ุฅุถุงูุฉ ุตูู -->
        <div id="modal-add-product" class="modal-content" style="display: none;">
            <h3>ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ</h3>
            <form id="form-add-product">
                <input type="text" id="new-prod-name" placeholder="ุงุณู ุงูุตูู" required>
                <input type="number" id="new-prod-buy" placeholder="ุณุนุฑ ุงูุดุฑุงุก" step="0.01" required>
                <input type="number" id="new-prod-sell" placeholder="ุณุนุฑ ุงูุจูุน" step="0.01" required>
                <input type="number" id="new-prod-stock" placeholder="ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู" required>
                <div class="modal-actions">
                    <button type="button" class="btn-close-modal btn-danger">ุฅูุบุงุก</button>
                    <button type="submit" class="btn-primary">ุญูุธ</button>
                </div>
            </form>
        </div>

        <!-- ุฅุถุงูุฉ ุดุฑูู -->
        <div id="modal-add-partner" class="modal-content" style="display: none;">
            <h3>ุฅุถุงูุฉ ุนููู / ููุฑุฏ</h3>
            <form id="form-add-partner">
                <input type="text" id="new-partner-name" placeholder="ุงูุงุณู" required>
                <select id="new-partner-type" required>
                    <option value="customer">ุนููู</option>
                    <option value="supplier">ููุฑุฏ</option>
                </select>
                <div class="modal-actions">
                    <button type="button" class="btn-close-modal btn-danger">ุฅูุบุงุก</button>
                    <button type="submit" class="btn-primary">ุญูุธ</button>
                </div>
            </form>
        </div>

        <!-- ุฅุถุงูุฉ ุฏูุนุฉ -->
        <div id="modal-add-payment" class="modal-content" style="display: none;">
            <h3>ุชุณุฌูู ุฏูุนุฉ ููุฏูุฉ</h3>
            <p id="payment-partner-name-display" style="text-align: center; font-weight: bold;"></p>
            <form id="form-add-payment">
                <input type="hidden" id="payment-partner-id">
                <input type="number" id="payment-amount" placeholder="ุงููุจูุบ" step="0.01" required>
                <input type="date" id="payment-date" required>
                <input type="text" id="payment-note" placeholder="ููุงุญุธุงุช">
                <div class="modal-actions">
                    <button type="button" class="btn-close-modal btn-danger">ุฅูุบุงุก</button>
                    <button type="submit" class="btn-success">ุชุฃููุฏ</button>
                </div>
            </form>
        </div>

    </div>

    <!-- ุงุณุชุฏุนุงุก ููู ุงูุฌุงูุงุณูุฑูุจุช ุงูุฑุฆูุณู -->
    <script type="module" src="app.js"></script>
    <script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>